import os
import sys
loc = os.path.dirname(os.path.abspath(__file__))
loc = os.path.dirname(loc)
sys.path.append(loc)
from algorithm.predict.prophet import *
from algorithm.config import *
# import platform

raw_data = sys.argv[1]
# print("raw_data")
# sys.stdout.flush()
# raw_data = '{"4621646571244256":"æŠ±æŠ±ä½  éŸ¬éŸ¬ä¸å“­@YKYBtao-é»„å­éŸ¬ Â¡è¯„è®ºé…å›¾","4621647769764439":"æŠ±æŠ±å®è´@YKYBtao-é»„å­éŸ¬ åˆ«å“­ï¼Œæˆ‘ä¸€ç›´åœ¨ï¼Œä¸€ç›´é™ªä¼´ä½  Â¡è¯„è®ºé…å›¾","4621647221622425":"å®è´ä½ æ˜¯æˆ‘ä»¬çš„éª„å‚²åŠ æ²¹","4621647401189567":"éŸ¬éŸ¬åŠ æ²¹ä½ å’ŒéŸ¬å¦ˆçœŸçš„å¾ˆåšå¼º","4621701683874254":"åœ¨ğŸ‰è§†é¢‘çœ‹äº†ç‹¬å®¶ï¼Œé»„å­éŸ¬åŠ æ²¹","4621669035415706":"éŸ¬çˆ¸è™½ç„¶åˆšå¼€å§‹ä¸æ”¯æŒéŸ¬åšè¿™ä¸€è¡Œï¼Œä½†æ˜¯åœ¨éŸ¬éŸ¬çš„åšæŒä¸‹åŒæ„éŸ¬éŸ¬å»éŸ©å›½ï¼ŒéŸ¬ä»¥å‰åœ¨è·¯è¾¹å‘ä¼ å•ï¼ŒéŸ¬çˆ¸å°±å¼€ç€è½¦å·å·è·Ÿç€ä¸€ç›´åˆ°éŸ¬ä¸Šå…¬äº¤è½¦æ‰æ”¾å¿ƒï¼Œå®³æ€•éŸ¬é‡åˆ°åº¸åŒ»å°±è‡ªå·±å»å­¦åŒ»ï¼ŒéŸ¬çˆ¸ä¹Ÿä¸€ç›´æ”¯æŒéŸ¬çš„äº‹ä¸šï¼ŒéŸ¬å›å›½åå’ŒéŸ¬ä¸€èµ·å¼€äº†ç»çºªå…¬å¸ï¼Œæ˜¯ä¸€ä½éå¸¸ä¼Ÿå¤§çš„çˆ¶äº²ï¼ŒéŸ¬éŸ¬ä¸€å®š","4621648537326439":"æŠ±æŠ±éŸ¬éŸ¬ æµ·æµªä¸€ç›´åœ¨@YKYBtao-é»„å­éŸ¬","4621647846051537":"æŠ±æŠ±ä½ éŸ¬çˆ¸ä¸€å®šä¼šä»¥ä½ ä¸ºè£è¦åšå¼º@YKYBtao-é»„å­éŸ¬","4621702602949786":"åœ¨è¥¿ç“œè¦–é »çœ‹äº†ç‹¬å®¶ï¼Œæœ‰ç‚¹éš¾å—","4621702174345361":"å¸Œæœ›æˆ‘ä»¬å¥½å¥½å¯¹è‡ªå·±çš„äº²äººï¼Œä»ğŸ‰è§†é¢‘è¿‡æ¥çš„","4621704179746847":"ğŸ‰è§†é¢‘çš„ç‹¬å®¶çœ‹äº†æ›´éš¾å—","4621701939464478":"ğŸ‰è§†é¢‘åˆ·åˆ°çš„ï¼Œæœç„¶ä¸Šçƒ­æœäº†","4621648168227517":"å®è´æˆ‘ä»¬é™ªä½ @YKYBtao-é»„å­éŸ¬","4621649142613084":"é»„å­éŸ¬åŠ æ²¹æµ·æµªä¸€ç›´åœ¨","4621648202042171":"æŠ±æŠ±å“¥å“¥","4621648906422339":"éŸ¬éŸ¬ä¸å“­","4621648692774601":"å¿ƒç–¼é»„å­éŸ¬ï¼Œæµ·æµªæ°¸è¿œé™ªç€ä½ ","4621648278588039":"éŸ¬éŸ¬æˆ‘ä»¬ä¸å“­@YKYBtao-é»„å­éŸ¬ Â¡è¯„è®ºé…å›¾","4621647958514221":"çœ‹é»„å­éŸ¬å“­æˆ‘ä¹Ÿå¥½éš¾è¿‡","4621646218397561":"éŸ¬éŸ¬ä¸å“­","4621649435170526":"å¿ƒç–¼éŸ¬éŸ¬ï¼Œç»™éŸ¬éŸ¬æ“¦çœ¼æ³ª","4621653557904829":"æŠ±æŠ±ä½ éŸ¬çˆ¸ä¸€å®šä¼šä»¥ä½ ä¸ºè£è¦åšå¼º@YKYBtao-é»„å­éŸ¬","4621679047213115":"çœŸçš„èƒ½æ„ŸåŒèº«å— æˆ‘çˆ¸çˆ¸ä¸åœ¨å®ˆæŠ¤æˆ‘å·²ç»21å¤©äº† è¿™21å¤©æˆ‘æ¯å¤©éƒ½æ˜¯æµ‘æµ‘å™©å™© å¦ˆå¦ˆæ›´æ˜¯ æˆ‘ä¸æ•¢å½“ç€å¦ˆå¦ˆçš„é¢å“­ çœŸçš„å¾ˆéš¾è¿‡ é‚£ç§æ„Ÿè§‰çœŸçš„åªæœ‰ç»å†è¿‡æ‰èƒ½æ„ŸåŒèº«å— ä¸æ˜¯ç²‰ æ˜¯çº¯è·¯äºº ä½†æ˜¯æƒ³è¯´ åŠ æ²¹ è¦å’Œå¦ˆå¦ˆä¿é‡èº«ä½“  è¦å¥½å¥½çš„ å¤©å ‚çš„çˆ¶äº²çœ‹åˆ°å¥½å¥½çš„","4621655488070322":"#é»„å­éŸ¬æˆ‘æ„¿æ„ç”¨åå¹´æ¢çˆ¶äº²ä¸€å¹´# å®è´ï¼Œä½ å¾ˆå¥½@YKYBtao-é»„å­éŸ¬","4621649905193922":"æŠ±æŠ±ï¼Œä½ å¾ˆåšå¼ºï¼ŒåŠ æ²¹æˆ‘é™ªä½ @YKYBtao-é»„å­éŸ¬","4621655198669210":"å®è´æˆ‘ä»¬é™ªä½ @YKYBtao-é»„å­éŸ¬ Â¡è¯„è®ºé…å›¾","4621652442483134":"æŠ±æŠ±éŸ¬éŸ¬ï¼Œä¸å“­ï¼ŒéŸ¬çˆ¸ä¼šç”¨å¦ä¸€ç§æ–¹å¼ä¸€ç›´å®ˆæŠ¤ç€ä½ ","4621651540709756":"æŠ±æŠ±å®è´ï¼Œä½ æ˜¯æˆ‘ä»¬çš„éª„å‚²@YKYBtao-é»„å­éŸ¬"}'
raw_json = json.loads(raw_data)
# print(raw_json)
user_id = '666'
url_id = '666'
comment_emoji = '666'
nickname = '666'
like_count = '666'
reply_count = '666'
be_co_retweet = '666'
be_co_comments = '666'
be_co_like = '666'
author = '666'
be_contents = '666'
be_emoji = '666'
obj = {}
for key, value in raw_json.items():
    str_key = '|'.join([key, user_id, url_id])
    obj_value = {
        'comment_text': '|'.join(value.split(',')),
        'comment_emoji': comment_emoji,
        'nickname': nickname,
        'like_count': like_count,
        'reply_count': reply_count,
        'be_co_retweet': be_co_retweet,
        'be_co_comments': be_co_comments,
        'be_co_like': be_co_like,
        'author': author,
        'be_contents': be_contents,
        'be_emoji': be_emoji
    }
    str_value = json.dumps(obj_value)
    obj[str_key] = str_value
    # print(str_key)
    # print(str_value)

# print(obj)
cft = CommentsFilter(obj, output=False, test=False)
res = cft.persist_storage()
print(json.dumps(res))
# aa = r.hgetall('tmp1')
# for key, value in aa.items():
#     aa = json.loads(value)
#     print(aa)
# print(fake_json)


# print data here  to send back
# print(raw_data)
# sys.stdout.flush()
